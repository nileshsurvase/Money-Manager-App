import{j as e,A as de,m as A}from"./ui-CeF3mqTb.js";import{r as a}from"./router-x15TIwzH.js";import{C as u}from"./Card-BuWKqhYc.js";import{h as ce,i as xe,b as me,B as n,j as ge,k as ue,l as he}from"./index-DCndX48W.js";import{M as L,S as Y}from"./Select-BXt2o8ak.js";import{I as ye}from"./Input-3yWY-vqC.js";import{g as pe,a as fe,f as q,b as je,c as Ne,e as ve,d as be}from"./dateHelpers-JLmekWSI.js";import{u as ke,j as we,v as Ce,T as Me,x as U,i as Be,w as Se,p as De,z as Ie,D as Te}from"./icons-Dv2osvF6.js";import"./vendor-Csw2ODfV.js";import"./utils-D8kRLn_f.js";const Ue=()=>{const[h,K]=a.useState([]),[y,W]=a.useState([]),[p,G]=a.useState([]),[H,D]=a.useState(!0),[J,f]=a.useState(!1),[c,I]=a.useState(null),[Q,j]=a.useState(!1),[x,T]=a.useState(null),[m,V]=a.useState("month"),[r,v]=a.useState(0),[l,b]=a.useState({categoryId:"",amount:"",period:"monthly"}),[g,N]=a.useState({}),[k,E]=a.useState(!1);a.useEffect(()=>{w()},[]);const w=()=>{D(!0);try{const t=ce(),s=xe(),o=me();K(t),W(s),G(o)}catch(t){console.error("Error loading data:",t)}finally{D(!1)}},$=a.useMemo(()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth()+r,1);return pe(s.getFullYear(),s.getMonth())},[r]),X=a.useMemo(()=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth()+r,1);return fe(s)},[r]),Z=()=>{v(t=>t-1)},_=()=>{v(t=>t+1)},F=t=>{V(t),v(0)},ee=a.useMemo(()=>{if(r!==0){const{start:t,end:s}=$;return q(y,t,s)}if(m==="lastMonth"){const{start:t,end:s}=je();return q(y,t,s)}else return Ne(y)},[y,m,r,$]),P=ve(ee),C=a.useMemo(()=>h.map(t=>{const s=p.find(oe=>oe.id===t.categoryId),o=be(P[t.categoryId]||[]),d=t.amount>0?o/t.amount*100:0,ie=t.amount-o;return{...t,category:s,spent:o,percentage:d,remaining:ie,status:d>=100?"exceeded":d>=80?"warning":"good"}}),[h,p,P]),O=h.reduce((t,s)=>t+s.amount,0),z=C.reduce((t,s)=>t+s.spent,0),M=O-z,i=t=>{const s=Math.abs(t);return s>=1e6?(t/1e6).toFixed(1)+"M":s>=1e3?(t/1e3).toFixed(1)+"K":t.toFixed(2)},R=()=>r!==0?X:m==="lastMonth"?"Last Month":"This Month",te=p.filter(t=>!h.some(s=>s.categoryId===t.id)||c&&c.categoryId===t.id).map(t=>({value:t.id,label:`${t.icon} ${t.name}`})),B=t=>{const{name:s,value:o}=t.target;b(d=>({...d,[s]:o})),g[s]&&N(d=>({...d,[s]:""}))},se=()=>{const t={};return l.categoryId||(t.categoryId="Please select a category"),(!l.amount||isNaN(l.amount)||Number(l.amount)<=0)&&(t.amount="Please enter a valid amount"),N(t),Object.keys(t).length===0},ae=async t=>{if(t.preventDefault(),!!se()){E(!0);try{const s={...l,amount:Number(l.amount)};c?await ge(c.id,s):await ue(s),w(),S()}catch(s){console.error("Error saving budget:",s),N({submit:"Failed to save budget. Please try again."})}finally{E(!1)}}},ne=t=>{I(t),b({categoryId:t.categoryId,amount:t.amount.toString(),period:t.period}),f(!0)},re=t=>{T(t),j(!0)},le=async()=>{x&&(await he(x.id),w(),j(!1),T(null))},S=()=>{f(!1),I(null),b({categoryId:"",amount:"",period:"monthly"}),N({})};return H?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"spinner"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Budgets"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Set and track your spending limits by category"})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:m==="month"&&r===0?"primary":"secondary",size:"small",onClick:()=>F("month"),children:"This Month"}),e.jsx(n,{variant:m==="lastMonth"&&r===0?"primary":"secondary",size:"small",onClick:()=>F("lastMonth"),children:"Last Month"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(n,{variant:"ghost",size:"small",onClick:Z,children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center space-x-2 min-w-[200px] justify-center",children:[e.jsx(we,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:R()})]}),e.jsx(n,{variant:"ghost",size:"small",onClick:_,children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Me,{className:"h-8 w-8 text-primary-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Budget"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 break-all",children:["$",i(O)]})]})]}),e.jsxs(n,{onClick:()=>f(!0),variant:"secondary",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Add Budget"]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Be,{className:"h-8 w-8 text-red-500"})}),e.jsxs("div",{className:"ml-4 min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Spent"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 break-all",children:["$",i(z)]})]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Se,{className:`h-8 w-8 ${M>=0?"text-green-500":"text-red-500"}`})}),e.jsxs("div",{className:"ml-4 min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Remaining"}),e.jsxs("p",{className:`text-2xl font-bold break-all ${M>=0?"text-green-500":"text-red-500"}`,children:["$",i(M)]})]})]})})]})]}),e.jsxs(u,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-6",children:["Budget Progress - ",R()]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(de,{children:C.map((t,s)=>e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:s*.05},className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white flex-shrink-0",style:{backgroundColor:t.category?.color||"#6b7280"},children:t.category?.icon||"ðŸ“"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.category?.name||"Unknown Category"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:["$",i(t.spent)," of $",i(t.amount)]})]}),t.status==="exceeded"&&e.jsx(De,{className:"h-5 w-5 text-red-500 flex-shrink-0"})]}),e.jsxs("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[e.jsxs("span",{className:`text-sm font-medium ${t.status==="exceeded"?"text-red-500":t.status==="warning"?"text-yellow-500":"text-green-500"}`,children:[t.percentage.toFixed(1),"%"]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(n,{variant:"ghost",size:"small",onClick:()=>ne(t),children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"small",onClick:()=>re(t),children:e.jsx(Te,{className:"h-4 w-4 text-red-500"})})]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx(A.div,{initial:{width:0},animate:{width:`${Math.min(t.percentage,100)}%`},transition:{duration:.5,delay:s*.1},className:`h-3 rounded-full transition-all duration-300 ${t.status==="exceeded"?"bg-red-500":t.status==="warning"?"bg-yellow-500":"bg-green-500"}`})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"break-all",children:["Spent: $",i(t.spent)]}),e.jsxs("span",{className:`break-all ${t.remaining>=0?"text-green-600":"text-red-600"}`,children:[t.remaining>=0?"Remaining":"Over budget",": $",i(Math.abs(t.remaining))]})]})]},t.id))}),C.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸŽ¯"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No budgets set"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Start managing your spending by setting budgets for different categories."}),e.jsxs(n,{onClick:()=>f(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Create Your First Budget"]})]})]})]}),e.jsx(L,{isOpen:J,onClose:S,title:c?"Edit Budget":"Add New Budget",size:"medium",children:e.jsxs("form",{onSubmit:ae,className:"space-y-4",children:[e.jsx(Y,{label:"Category",name:"categoryId",value:l.categoryId,onChange:B,options:te,error:g.categoryId,placeholder:"Select a category",required:!0}),e.jsx(ye,{label:"Budget Amount",name:"amount",type:"number",step:"0.01",min:"0",value:l.amount,onChange:B,error:g.amount,placeholder:"0.00",required:!0}),e.jsx(Y,{label:"Period",name:"period",value:l.period,onChange:B,options:[{value:"monthly",label:"Monthly"},{value:"weekly",label:"Weekly"}],required:!0}),g.submit&&e.jsx("div",{className:"text-red-600 dark:text-red-400 text-sm",children:g.submit}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(n,{type:"button",variant:"secondary",onClick:S,disabled:k,children:"Cancel"}),e.jsxs(n,{type:"submit",loading:k,disabled:k,children:[c?"Update":"Add"," Budget"]})]})]})}),e.jsx(L,{isOpen:Q,onClose:()=>j(!1),title:"Delete Budget",size:"small",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Are you sure you want to delete this budget? This action cannot be undone."}),x&&e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:p.find(t=>t.id===x.categoryId)?.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:["$",i(x.amount)," ",x.period]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(n,{variant:"secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx(n,{variant:"danger",onClick:le,children:"Delete"})]})]})})]})};export{Ue as default};
